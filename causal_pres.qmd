---
title: 'Introduction to G-methods'
subtitle: 'Dealing with Time-varying Covariates in Causal Inverence'
date: ''
format: 
  baylor_theme-revealjs:
    author: ' '
    footer: 'Nathen Byford'
---

```{r setup, include=FALSE}
library(tidyverse)
library(ggdag)
```


## Longitudinal Studies

- Often observe Time-varying covariates

## Motivating example

- In HIV treatment, CD4 count is used to measure the effect of treatment.
    - Higher CD4, the better the treatment is working
- CD4 is also effected by HIV viral load
    - This is measured before the second treatment is administered as baseline


## Traditional Regression model

$$
\hat{y} = X_0 + \beta_1 X_1 + ... + \varepsilon
$$

Assumptions:

## G-formula

Key idea:

Using counterfactuals we are able to get a better idea of the treatement effects.

Assumptions:

1. Counterfactual consistency:
2. Exchangeability:
3. Positivity:

![Naimi et al. 2016](Assumptions_dag.png)

::: {.notes}
In the motivating example, A0 is the first treatment, Z1 is the viral load, A1 is the second treatment, Y is the CD4, and u is the unmeasured confounder on viral load and CD4.
:::

## G-computation

```{mermaid}
%%| label: 'steps_gcomp'
%%| fig-align: 'center'

flowchart LR
  id1("Step1: Obtain the \n empirical parameters")
  id2("Step2: Estimate the \n counterfactual mean")
  id3("Step3: Fit into \n marginal structural model")
  id1 --> id2
  id2 --> id3
```

The main idea is to use counterfactuals to create an estimation of average effects.

# IP-weighting and Marginal Structural Models